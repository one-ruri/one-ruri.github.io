<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Kivy中文说明文档v1.0 - https://one-ruri.github.io/posts/kivy%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3v1-0/">
    <meta name="author" content="Jack - https://one-ruri.github.io/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Kivy中文说明文档v1.0</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://one-ruri.github.io/style.min.d252ad53a5e6b2ae6b8c6c1661107189be3668e36c8dd61697bbe008595a7e04.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate ">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"isSingleColumnOfPostList": true,
		"hasFoldAllCodeBlocks": false,
		"svgColor": "",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            Kivy中文说明文档v1.0
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill="#6c757d" p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill="#6c757d"></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill="#6c757d"></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill="#6c757d" p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill="#6c757d" p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill="#6c757d" p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill="#6c757d" p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill="#6c757d"></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">















<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2024-07-09&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2024-07-09&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            14696 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            30 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/python">Python</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://one-ruri.github.io/posts/nanui%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://one-ruri.github.io/posts/ubuntu%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#安装前提">安装前提</a></li>
    <li><a href="#安装过程">安装过程</a></li>
  </ul>

  <ul>
    <li><a href="#kivy环境安装搭建">Kivy环境安装搭建</a></li>
    <li><a href="#创建一个应用">创建一个应用</a></li>
    <li><a href="#kivy应用的生命周期">Kivy应用的生命周期</a></li>
    <li><a href="#运行应用">运行应用</a></li>
    <li><a href="#修改定制这个应用">修改定制这个应用</a></li>
  </ul>

  <ul>
    <li><a href="#路径控制">路径控制</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#配置文件">配置文件</a></li>
    <li><a href="#限定kivycore核心使用特定版本">限定Kivy.core核心，使用特定版本</a></li>
    <li><a href="#设置单位">设置单位</a></li>
    <li><a href="#图形输出">图形输出</a></li>
  </ul>

  <ul>
    <li><a href="#找到配置文件位置">找到配置文件位置</a></li>
    <li><a href="#本地配置">本地配置</a></li>
    <li><a href="#详细理解配置项">详细理解配置项</a></li>
  </ul>

  <ul>
    <li><a href="#核心模块和输入模块">核心模块和输入模块</a></li>
    <li><a href="#图形接口">图形接口</a></li>
    <li><a href="#核心模块">核心模块</a></li>
    <li><a href="#uix控件和布局">UIX（控件和布局）</a></li>
    <li><a href="#模块化">模块化</a></li>
    <li><a href="#输入事件touches">输入事件（Touches）</a></li>
    <li><a href="#控件和事件调度">控件和事件调度</a></li>
  </ul>

  <ul>
    <li><a href="#控件简介">控件简介</a></li>
    <li><a href="#操作控件树">操作控件树</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#遍历控件树">遍历控件树</a></li>
    <li><a href="#控件索引z">控件索引Z</a></li>
    <li><a href="#整理布局">整理布局</a></li>
    <li><a href="#给布局添加背景">给布局添加背景</a>
      <ul>
        <li><a href="#给自定义布局规则类增加背景色">给<strong>自定义布局规则/类</strong>增加背景色</a></li>
      </ul>
    </li>
    <li><a href="#网状布局">网状布局</a></li>
    <li><a href="#尺寸和位置度量">尺寸和位置度量</a></li>
    <li><a href="#使用屏幕管理器进行屏幕分割">使用屏幕管理器进行屏幕分割</a></li>
  </ul>

  <ul>
    <li><a href="#译者前言">译者前言</a></li>
    <li><a href="#简介canvas">简介Canvas</a></li>
    <li><a href="#环境指令">环境指令</a></li>
    <li><a href="#绘图指令">绘图指令</a></li>
    <li><a href="#操作指令">操作指令</a></li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 id="kivy简介">Kivy简介</h1>
<p>Kivy是Python的Gui的一种。</p>
<p>网上关于使用python进行ui设计的文档很少，因此为了自己方便，也为了这个领域的发展，于是编写初稿。</p>
<p><strong>注</strong>：本版本是在windows环境下使用的，后期其他系统可能会添加。</p>
<p><a href="https://cycleuser.gitbooks.io/kivy-guide-chinese/content/00-Kivy-CN.html">参考文献</a></p>
<h1 id="安装">安装</h1>
<p><strong>官网原文档链接</strong></p>
<p><a href="https://kivy.org/docs/installation/installation-windows.html">Installation on Windows</a></p>
<p><a href="https://kivy.org/docs/installation/installation-linux.html">Installation on Linux</a></p>
<p><a href="https://kivy.org/docs/installation/installation-osx.html">Installation on Mac OS</a></p>
<h2 id="安装前提">安装前提</h2>
<p>首先你得有一个合适的python环境</p>
<p>官方文档里面提及的是3.9的版本</p>
<p>国内安装比较慢，可以采用国内的开源镜像站</p>
<p><a href="https://mirrors.aliyun.com/python-release/">阿里云开源镜像站</a></p>
<p>之后最好设置下载镜像源为国内的，国外的比较慢</p>
<h2 id="安装过程">安装过程</h2>
<p>安装了Python之后，打开命令行工具cmd，然后按照下面的命令来进行Kivy的安装。</p>
<ol>
<li>首先要保证已经安装了最新的pip和wheel：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>python -m pip install --upgrade pip wheel setuptools
</span></span></code></pre></div><ol start="2">
<li>然后安装必要的依赖包(其中gstreamer大小接近139MB，如果不需要用，就可以跳过不安装这个包:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span>python <span style="color:#000;font-weight:bold">-</span>m pip install docutils pygments pypiwin32 kivy<span style="color:#000;font-weight:bold">.</span>deps<span style="color:#000;font-weight:bold">.</span>sdl2 kivy<span style="color:#000;font-weight:bold">.</span>deps<span style="color:#000;font-weight:bold">.</span>glew
</span></span><span style="display:flex;"><span>python <span style="color:#000;font-weight:bold">-</span>m pip install kivy<span style="color:#000;font-weight:bold">.</span>deps<span style="color:#000;font-weight:bold">.</span>gstreamer <span style="color:#000;font-weight:bold">--</span>extra<span style="color:#000;font-weight:bold">-</span>index<span style="color:#000;font-weight:bold">-</span>url https:<span style="color:#000;font-weight:bold">//</span>kivy<span style="color:#000;font-weight:bold">.</span>org<span style="color:#000;font-weight:bold">/</span>downloads<span style="color:#000;font-weight:bold">/</span>packages<span style="color:#000;font-weight:bold">/</span>simple<span style="color:#000;font-weight:bold">/</span>
</span></span></code></pre></div><ol start="3">
<li>如果上一步都成功了没什么报错，就可以安装Kivy了:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>python -m pip install kivy
</span></span></code></pre></div><ol start="4">
<li>在环境变量中添加一些路径到PATH来避免遇到<a href="https://github.com/kivy/kivy/issues/3957">各种issues</a> (在你的python.exe所在的路径下运行下面的命令):</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span><span style="color:#0086b3">set</span> <span style="color:#008080">PATH</span><span style="color:#000;font-weight:bold">=</span>%PATH%;%cd%<span style="color:#d14">\s</span>hare<span style="color:#d14">\s</span>dl2<span style="color:#d14">\b</span>in;%cd%<span style="color:#d14">\s</span>hare<span style="color:#d14">\g</span>lew<span style="color:#d14">\b</span>in
</span></span></code></pre></div><h1 id="基础">基础</h1>
<p><a href="https://kivy.org/docs/guide/basic.html">原文地址</a></p>
<h2 id="kivy环境安装搭建">Kivy环境安装搭建</h2>
<p>Kivy要依赖很多Python包，比如 pygame, gstreamer, PIL, Cairo 等等还有好多。这些包并非都是必需的，要根据你的运行平台来看具体情况，有时候缺那么一两个包就可能导致安装失败，或者运行过程中出错等等，这就挺痛苦的。所以Kivy官方针对Windows和MacOS X提供了集成好关键部件的压缩包，解压缩之后直接就能用。具体的安装过程可以参考下面链接中的中文安装指南：</p>
<ul>
<li><a href="http://blog.cycleuser.org/kivy-installment-tutorial.html">Kivy中文安装指南</a></li>
</ul>
<p>如果你非要自己从零开始安装，那最起码要确保安装有<a href="http://cython.org/">Cython</a>和<a href="http://pygame.org/">Pygame</a>。这两个包可以通过pip来安装，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>pip install cython
</span></span><span style="display:flex;"><span>pip install pygame
</span></span><span style="display:flex;"><span>pip install kivy
</span></span></code></pre></div><p><a href="https://github.com/kivy/kivy">Kivy的开发版本</a>也可以通过git来安装：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>git clone https://github.com/kivy/kivy
</span></span><span style="display:flex;"><span>make
</span></span></code></pre></div><h2 id="创建一个应用">创建一个应用</h2>
<p>创建一个Kivy应用大概步骤如下：</p>
<ul>
<li>基于App类创建一个子类；</li>
<li>把build()方法实现为返回一个控件实例(这个控件的实例也就是你整个应用的根控件)。</li>
<li>创建一个这个类的实例，然后调用run()方法。</li>
</ul>
<p>下面的代码就是上述思路的最小化实现：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">kivy</span>
</span></span><span style="display:flex;"><span>kivy<span style="color:#000;font-weight:bold">.</span>require(<span style="color:#d14">&#39;1.0.6&#39;</span>) <span style="color:#998;font-style:italic"># 注意要把这个版本号改变成你现有的Kivy版本号!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.app</span> <span style="color:#000;font-weight:bold">import</span> App <span style="color:#998;font-style:italic"># 译者注：这里就是从kivy.app包里面导入App类</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.label</span> <span style="color:#000;font-weight:bold">import</span> Label <span style="color:#998;font-style:italic"># 译者注：这里是从kivy.uix.label包中导入Label控件，这里都注意开头字母要大写</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyApp</span>(App):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">build</span>(<span style="color:#999">self</span>): <span style="color:#998;font-style:italic"># 译者注：这里是实现build()方法</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> Label(text<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;Hello world&#39;</span>) <span style="color:#998;font-style:italic"># 译者注：在这个方法里面使用了Label控件</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    MyApp()<span style="color:#000;font-weight:bold">.</span>run() <span style="color:#998;font-style:italic"># 译者注：这里就是运行了。</span>
</span></span></code></pre></div><p>把上面的代码以文本形式复制到一个文本文件中，保存成py文件，例如main.py，然后运行，就行了。</p>
<p><img src="./../images/Kivy%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3v1-0/image-20240709221042996.png" alt="运行截图"></p>
<h2 id="kivy应用的生命周期">Kivy应用的生命周期</h2>
<p>如上图所示，不论什么用途和目的，咱们应用的入口都是这个run()方法，在本文的样例代码中，就是“MyApp().run()”。</p>
<p>下面就一行一行开始详细解释了：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.app</span> <span style="color:#000;font-weight:bold">import</span> App
</span></span></code></pre></div><p>为什么要导入这个App类呢？因为咱们自定义的这个App要继承这个类。这个类的位置在kivy安装目录下的kivy目录下的app.py文件中。</p>
<p>如果你想要深入挖掘一下，去了解这个Kivy的App类到底是怎么个内容，你可以打开这个app.py文件，亲自来看看。Kivy作者特别鼓励大家去阅读源码。Kivy基于Python，用Sphinx编写的文档，所以每个类的文档都在对应的文件内。</p>
<p>然后咱们回过头来，继续看本文这次的代码的第二行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.label</span> <span style="color:#000;font-weight:bold">import</span> Label
</span></span></code></pre></div><p>这里一定要特别注意各种包和类的导入。&ldquo;kivy.uix&quot;这个包的作用是容纳用户界面元素，比如各种输出布局和控件。</p>
<p>接下来看到这一行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyApp</span>(App):
</span></span></code></pre></div><p>这一行定义了咱们这次的Kivy应用的基类。如果你要做修改的话，把MyApp改成你要设定的应用名字就可以了。</p>
<p>接着往下看：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">build</span>(<span style="color:#999">self</span>):
</span></span></code></pre></div><p>在上面的生命周期图中加粗强调的部分表明，build函数所处的是要进行初始化和返回根控件的位置。根控件返回的操作在下面这一行中实现：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> Label(text<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;Hello world&#39;</span>)
</span></span></code></pre></div><p>这里我们用文本‘Hello World’对Label这一控件进行了初始化，并且返回了其实例。这个Label就是咱们这个应用的根控件了。</p>
<p>Python是用缩进来区别代码块的，所以一定要注意上面代码的缩进和层次，尤其是函数定义那部分。</p>
<p>然后咱们继续，到了真正让应用开始运行的这部分了：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    MyApp()<span style="color:#000;font-weight:bold">.</span>run()
</span></span></code></pre></div><p>这里对MyApp这个类进行了初始化，然后调用了这个类的run()方法。这样就初始化并启动了我们的Kivy应用了。</p>
<h2 id="运行应用">运行应用</h2>
<p>接下来就是要在不同操作系统平台上来运行咱们刚刚写好的应用了：</p>
<p>To run the application, follow the instructions for your operating system:</p>
<ul>
<li>Windows 可以在CMD中以如下方式运行：</li>
</ul>
<pre tabindex="0"><code class="language-CMD" data-lang="CMD">$ python main.py #用系统Python运行
C:\appdir&gt;kivy.bat main.py #用kivy.bat来运行，注意这里要设定好正确的路径
</code></pre><ul>
<li>Android 下面要运行还需要一些复杂的文件，所以等以后深入了之后再给讲解这部分了。</li>
</ul>
<p>这个应用运行之后的具体效果就是下面图片所示这样，会打开一个窗口，然后展示出一个Label，上面写着文本‘Hello World’，这个Label会覆盖该窗口的全部区域。就这样了。</p>
<p><img src="./../images/Kivy%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3v1-0/quickstart.png" alt="img"></p>
<h2 id="修改定制这个应用">修改定制这个应用</h2>
<p>增加一个用户名/密码输入的页面</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.app</span> <span style="color:#000;font-weight:bold">import</span> App
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.gridlayout</span> <span style="color:#000;font-weight:bold">import</span> GridLayout
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.label</span> <span style="color:#000;font-weight:bold">import</span> Label
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.textinput</span> <span style="color:#000;font-weight:bold">import</span> TextInput
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">LoginScreen</span>(GridLayout):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(LoginScreen, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(Label(text<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;User Name&#39;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>username <span style="color:#000;font-weight:bold">=</span> TextInput(multiline<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>username)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(Label(text<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;password&#39;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>password <span style="color:#000;font-weight:bold">=</span> TextInput(password<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, multiline<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>password)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyApp</span>(App):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">build</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> LoginScreen()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> __name__ <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    MyApp()<span style="color:#000;font-weight:bold">.</span>run()
</span></span></code></pre></div><p><img src="./../images/Kivy%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3v1-0/image-20240709221537055.png" alt="运行截图"></p>
<p>在下面这行代码中，我们导入了一种名为Gridlayout的布局：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.uix.gridlayout</span> <span style="color:#000;font-weight:bold">import</span> GridLayout
</span></span></code></pre></div><p>这个类被我们用作基类来制作根控件LoginScreen，在如下代码中进行了定义：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">LoginScreen</span>(GridLayout):
</span></span></code></pre></div><p>如下代码中，我们在LoginScreen类中重新定义了初始化方法<strong>init</strong>()，这样来增加一些控件，并且定义了这些控件的行为：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>    <span style="color:#0086b3">super</span>(LoginScreen, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span></code></pre></div><p>一定要注意这里要加super，才能把现有的新初始化方法覆盖掉继承来的旧初始化方法。另外也要注意，这里调用super的时候没有省略掉**kwargs，这是一种好习惯。</p>
<p>然后继续往下看：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>cols <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(Label(text<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;User Name&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>username <span style="color:#000;font-weight:bold">=</span> TextInput(multiline<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>username)
</span></span><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(Label(text<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;password&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>password <span style="color:#000;font-weight:bold">=</span> TextInput(password<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">True</span>, multiline<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">False</span>)
</span></span><span style="display:flex;"><span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>add_widget(<span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>password)
</span></span></code></pre></div><p>上面的代码中，我们让GridLayout来管理子控件，把子控件设置为两栏，然后加上用户名和密码的Label字符显示控件和TextInput字符输入控件。</p>
<p>运行上面的代码，得到的窗口效果大概如下图：</p>
<p><img src="./../images/Kivy%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3v1-0/guide_customize_step1.png" alt="img"></p>
<p>尝试着重新缩放一下窗口大小，你会发现上面的控件会相对整个窗口的尺寸而自行调整大小，并不需要人为去操作了。这是因为这些控件都使用了默认的尺寸。</p>
<h1 id="环境">环境</h1>
<p><a href="https://kivy.org/docs/guide/environment.html">英文原文</a></p>
<p>Kivy的初始化和很多行为都可以通过各种环境变量来控制。</p>
<p>例如，若要严格设定用PIL进行文本渲染，可以通过如下方式来实现：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>$ <span style="color:#008080">KIVY_TEXT</span><span style="color:#000;font-weight:bold">=</span>pil python main.py
</span></span></code></pre></div><p>(译者注：PIL，Python Imaging Library, Python 下常用的绘图库)</p>
<p>所有的这些环境变量的修改设定都需要在导入Kivy之前进行，具体如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#39;KIVY_TEXT&#39;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;pil&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">kivy</span>
</span></span></code></pre></div><h2 id="路径控制">路径控制</h2>
<ul>
<li>从Kivy1.0.7版本开始提供</li>
</ul>
<p>You can control the default directories where config files, modules and kivy data are located.</p>
<p>Kivy的配置文件、模块以及数据存储的默认目录，都可手动设定所在位置。</p>
<blockquote>
<p>KIVY_DATA_DIR</p>
</blockquote>
<p>这个是Kivy的数据目录，默认值为/data 。</p>
<blockquote>
<p>KIVY_MODULES_DIR</p>
</blockquote>
<p>这个是Kivy的模块目录，默认值为/modules 。</p>
<blockquote>
<p>KIVY_HOME</p>
</blockquote>
<p>这个是Kivy的HOME目录，该目录是用来存放本地配置文件的，必须是一个可以写入的位置。对应不同系统也有不同位置：</p>
<pre tabindex="0"><code>* Desktop: /.kivy
* Android: /.kivy
* iOS: /Documents/.kivy
</code></pre><ul>
<li>从Kivy1.9.0版本开始提供</li>
</ul>
<blockquote>
<p>KIVY_SDL2_PATH</p>
</blockquote>
<p>这个变量若设定了，编译Kivy的时候就会使用该位置的SDL2库文件，而不再使用系统的库文件。在环境变量PATH的开头部位就要设定好这个变量，这样在运行一个Kivy应用的时候才能也使用相同的SDL2库文件。</p>
<ul>
<li>从Kivy1.9.0版本开始提供</li>
</ul>
<h4 id="特别注意">特别注意</h4>
<p>刚刚这个SDL2路径是用来编译Kivy的。运行程序的话就用不着了。</p>
<h2 id="配置文件">配置文件</h2>
<blockquote>
<p>KIVY_USE_DEFAULTCONFIG</p>
</blockquote>
<p>若设定了此环境变量，Kivy会读取制定的配置文件。</p>
<blockquote>
<p>KIVY_NO_CONFIG</p>
</blockquote>
<p>若设定了此环境变量，Kivy将不会读取也不会写入任何配置文件。也适用于用户配置文件夹的位置。（译者注：这句话我还没弄明白，因为没有这样尝试。）</p>
<blockquote>
<p>KIVY_NO_FILELOG</p>
</blockquote>
<p>若设定了此环境变量，日志将不再输出到文件内。</p>
<blockquote>
<p>KIVY_NO_CONSOLELOG</p>
</blockquote>
<p>若设定了此环境变量，日志将不再输出到控制台。</p>
<blockquote>
<p>KIVY_NO_ARGS</p>
</blockquote>
<p>若设定了此环境变量，命令行传递的参数将不会被Kivy解析和使用。也就是说，可以不用 – 定义符，就能随便创建一个使用自己参数的脚本或者应用：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#34;KIVY_NO_ARGS&#34;</span>] <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">kivy</span>
</span></span></code></pre></div><ul>
<li>从Kivy1.9.0版本开始提供</li>
</ul>
<h2 id="限定kivycore核心使用特定版本">限定Kivy.core核心，使用特定版本</h2>
<p>Kivy.core会尝试使用所在平台的最优实现。如果要测试或者定制安装，你可能要把选择器设定为某个特定版本的kivy.core。</p>
<blockquote>
<p>KIVY_WINDOW</p>
</blockquote>
<p>这一变量是用来设定如何创建窗口，可用值：sdl2, pygame, x11, egl_rpi</p>
<blockquote>
<p>KIVY_TEXT</p>
</blockquote>
<p>这一变量是用来设定如何渲染文本，可用值：sdl2, pil, pygame, sdlttf</p>
<blockquote>
<p>KIVY_VIDEO</p>
</blockquote>
<p>这一变量是用来设定如何渲染视频，可用值：pygst, gstplayer, pyglet, ffpyplayer, ffmpeg, gi, null</p>
<blockquote>
<p>KIVY_AUDIO</p>
</blockquote>
<p>这一变量是用来设定如何播放声音，可用值：sdl2, gstplayer, pygst, ffpyplayer, pygame, gi, avplayer</p>
<blockquote>
<p>KIVY_IMAGE</p>
</blockquote>
<p>这一变量是用来设定如何读取图像，可用值：sdl2, pil, pygame, imageio, tex, dds, gif</p>
<blockquote>
<p>KIVY_CAMERA</p>
</blockquote>
<p>这一变量是用来设定如何读取摄像头，可用值：videocapture, avfoundation, pygst, opencv</p>
<blockquote>
<p>KIVY_SPELLING</p>
</blockquote>
<p>这一变量是用来设定拼写，可用值： enchant, osxappkit</p>
<blockquote>
<p>KIVY_CLIPBOARD</p>
</blockquote>
<p>这一变量是用来设定剪切板管理组件，可用值：sdl2, pygame, dummy, android</p>
<h2 id="设置单位">设置单位</h2>
<blockquote>
<p>KIVY_DPI</p>
</blockquote>
<p>这个是用来设定Metrics.dpi的dpi值的。</p>
<ul>
<li>从Kivy1.4.0版本开始提供</li>
</ul>
<blockquote>
<p>KIVY_METRICS_DENSITY</p>
</blockquote>
<p>这个是用来设定Metrics.density，像素密度。</p>
<ul>
<li>从Kivy1.5.0版本开始提供</li>
</ul>
<blockquote>
<p>KIVY_METRICS_FONTSCALE</p>
</blockquote>
<p>这个是用来设定Metrics.fontscale，字体大小。</p>
<ul>
<li>从Kivy1.5.0版本开始提供</li>
</ul>
<h2 id="图形输出">图形输出</h2>
<blockquote>
<p>KIVY_GL_BACKEND</p>
</blockquote>
<p>此变量用于设定使用的OpenGL后端，更多细节参考<a href="http://kivy.org/docs/api-kivy.graphics.cgl.html#module-kivy.graphics.cgl">cgl</a>.</p>
<blockquote>
<p>KIVY_GL_DEBUG</p>
</blockquote>
<p>此变量用于设定是否对OpenGL调用进行日志记录，更多细节参考<a href="http://kivy.org/docs/api-kivy.graphics.cgl.html#module-kivy.graphics.cgl">cgl</a>.</p>
<blockquote>
<p>KIVY_GRAPHICS</p>
</blockquote>
<p>此变量用于设定是否使用OpenGL ES2，更多细节参考<a href="http://kivy.org/docs/api-kivy.graphics.cgl.html#module-kivy.graphics.cgl">cgl</a>.</p>
<blockquote>
<p>KIVY_GLES_LIMITS</p>
</blockquote>
<p>此变量用于设定是否强制设定GLES2（默认值为启用，设置为1）。如果设定为false，Kivy将不再兼容GLES2。（译者注：这部分我不懂，就直接生硬翻译了原文，建议大家参考一下原文去理解。）如果设置为true，可能有下表中所示的潜在的不兼容情况：</p>
<table>
  <thead>
      <tr>
          <th>Mesh indices</th>
          <th style="text-align: center">If true, the number of indices in a mesh is limited to 65535</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Texture blit</td>
          <td style="text-align: center">When blitting to a texture, the data (color and buffer) format must be the same format as the one used at the texture creation. On desktop, the conversion of different color is correctly handled by the driver, while on Android, most of devices fail to do it. Ref: <a href="https://github.com/kivy/kivy/issues/1600">https://github.com/kivy/kivy/issues/1600</a></td>
      </tr>
  </tbody>
</table>
<ul>
<li>从Kivy1.8.1版本开始提供</li>
</ul>
<blockquote>
<p>KIVY_BCM_DISPMANX_ID</p>
</blockquote>
<p>此变量是针对Raspberry Pi树莓派平台的，用于设定所选择的视频输出端口。默认值为0，下面列表中是在vc_dispmanx_types.h这个头文件中存储的可供选择的变量值：</p>
<ul>
<li>0: DISPMANX_ID_MAIN_LCD</li>
<li>1: DISPMANX_ID_AUX_LCD</li>
<li>2: DISPMANX_ID_HDMI</li>
<li>3: DISPMANX_ID_SDTV</li>
<li>4: DISPMANX_ID_FORCE_LCD</li>
<li>5: DISPMANX_ID_FORCE_TV</li>
<li>6: DISPMANX_ID_FORCE_OTHER</li>
</ul>
<p>（译者注：上面0-6分别是不同的显示输出端口，相信很容易看懂，大家探索一下吧。）</p>
<h1 id="配置">配置</h1>
<p><a href="https://kivy.org/docs/guide/config.html">英文原文</a></p>
<p>Kivy的配置文件是一个名为config.ini的文本，符合<a href="http://en.wikipedia.org/wiki/INI_file">标准INI格式</a>。</p>
<h2 id="找到配置文件位置">找到配置文件位置</h2>
<p>Kivy的配置文件存放在环境变量KIVY_HOME所制定的位置：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>KIVY_HOME&gt;/config.ini
</span></span></code></pre></div><p>在桌面平台上，默认的位置如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>HOME_DIRECTORY&gt;/.kivy/config.ini
</span></span></code></pre></div><p>所以，假设你的用户名是“tito”，在各个操作系统下的配置文件位置则如下所示：</p>
<ul>
<li>Windows: <code>C:\Users\tito\.kivy\config.ini</code></li>
<li>OS X: <code>/Users/tito/.kivy/config.ini</code></li>
<li>Linux: <code>/home/tito/.kivy/config.ini</code></li>
</ul>
<p>（译者注：这里要注意，tito只是原文的一个示范，相当于张三李四这样，新手可别照着复制找不到，要用自己操作系统中具体的用户名。）</p>
<p>在Android系统中位置如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>ANDROID_APP_PATH&gt;/.kivy/config.ini
</span></span></code></pre></div><p>假如你的Kivy应用的包名称为“org.kivy.launcher”,那么该Kivy应用的配置文件位于:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>/data/data/org.kivy.launcher/files/.kivy/config.ini
</span></span></code></pre></div><p>在iOS上Kivy的默认配置文件位于：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>HOME_DIRECTORY&gt;/Documents/.kivy/config.ini
</span></span></code></pre></div><h2 id="本地配置">本地配置</h2>
<p>有时候用户或者开发者可能需要针对特定的应用来修改配置，或者对Kivy的某个组件进行测试，比如输入模块之类的。这时候就可以用如下命令创建一份新的配置文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">from</span> <span style="color:#555">kivy.config</span> <span style="color:#000;font-weight:bold">import</span> Config
</span></span><span style="display:flex;"><span>Config<span style="color:#000;font-weight:bold">.</span>read(file<span style="color:#000;font-weight:bold">&gt;</span>)
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># set config</span>
</span></span><span style="display:flex;"><span>Config<span style="color:#000;font-weight:bold">.</span>write()
</span></span></code></pre></div><p>有时候本地配置只有一个.ini文件还不够用，比如说可能你要单独使用某个garden、Kivy日志或者其他什么模块，这时候就要把KIVY_HOME这个环境变量进行修改了，指定到目标位置就行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">os</span>
</span></span><span style="display:flex;"><span>os<span style="color:#000;font-weight:bold">.</span>environ[<span style="color:#d14">&#39;KIVY_HOME&#39;</span>] <span style="color:#000;font-weight:bold">=</span> folder<span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>还有一种思路，就是在运行Kivy应用之前，在终端中手动修改一下这个环境变量：</p>
<ol>
<li>Windows: <code>set KIVY_HOME=folder&gt;</code></li>
<li>Linux &amp; OSX: <code>export KIVY_HOME=folder&gt;</code></li>
</ol>
<p>在设置了KIVY_HOME之后，所指定的这个文件夹就会被当做默认的.kivy文件夹来用。</p>
<h2 id="详细理解配置项">详细理解配置项</h2>
<p>在<a href="http://kivy.org/docs/api-kivy.config.html#module-kivy.config">kivy.config</a> 模块中可以看到全部的配置项的解释。</p>
<h1 id="架构">架构</h1>
<p><a href="https://kivy.org/docs/guide/architecture.html">英文原文</a></p>
<p>本章我们将从软件工程的角度，来简单介绍一下Kivy的设计。这对于理解各个部分如何配合工作会有帮助。如果你只关注代码，可能有时候会遇到这样一种情况，就是你已经有了一个初步的想法了，但具体怎么去实现可能还是一头雾水，所以本章就针对这种情况，来更深入地讲解一下Kivy的一些基本思想。你也可以先跳过这一章，等以后再翻回来看，不过我们建议开发者还是先看一下这些内容比较好，起码可以快速略读一下有个印象。</p>
<p>Kivy包含的若干个模块，我们将对这些模块一一进行简要说明。下面这幅图是Kivy整个架构的概括图示：</p>
<p><img src="./../images/Kivy%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3v1-0/architecture.png" alt="../_images/architecture.png"></p>
<h2 id="核心模块和输入模块">核心模块和输入模块</h2>
<p>对理解Kivy的设计内涵，模块化和抽象化的思想是至关重要的。我们试图把各种基本的任务进行抽象，比如打开窗口、显示图像和文本、播放音频、从摄像头获取图像、拼写校正等等。我们将这些部分称为<strong>核心</strong>任务。这样也使得API接口用起来比较简单，扩展起来也容易。更重要的是，这种思路可以让Kivy应用在运行的时候，使用各个运行平台所提供的对应功能的API接口。例如，在苹果的MacOS操作系统、Linux操作系统和Windows操作系统中，就都有各自不同的原生API接口提供各种核心功能。所以就有一部分代码，调用这些不同接口中的某一个，一方面与操作系统进行通信，另一方面与Kivy进行交互，起到中间人的角色，我们称之为<strong>核心模块</strong>。针对不同的操作系统平台要使用各自对应的核心模块，这样的好处是达到一种均衡状态，既能够充分利用操作系统提供的功能，又能尽量提高开发效率。（译者注：我的理解是这样大家平时不用针对不同操作系统去学习和使用各自的API，而只要专心使用Kivy的核心模块进行调用就行了。）这也允许用户来自由选择，使用Kivy提供的核心模块，或者直接使用各个操作系统的API接口。此外，由于使用了各个平台所提供的链接库文件，我们大大减小了Kivy发型版本的体积，也使得打包发布更加容易。这有助于将Kivy应用移植到其他平台。比如Android平台上的Kivy应用就体现了这一特性的好处了。</p>
<p>在输入模块这部分，我们也遵循了同样的思路。<strong>输入模块</strong>，是一段代码，用于针对各种输入设备提供支持，比如苹果公司的Trackpad触摸板，TUIO多点触摸设备，或者是鼠标模拟器等等。如果你需要对某一种新的输入设备添加支持，只需要提供一个新的类，用这个类来读取输入设备的数据，然后传递给Kivy基本事件，就可以了。</p>
<h2 id="图形接口">图形接口</h2>
<p>Kivy的图形接口是对OpenGL的抽象。在最底层，Kivy使用OpenGL的命令来进行硬件加速的图形绘制。不过写OpenGL的代码可还是挺复杂的，新手就更难以迅速掌握了。所以我们就提供了一系列的图形接口，利用这些接口可以很简单地进行图形绘制，这些接口中用到了例如画布Canvas、矩形Rectangle等几何概念，比OpenGL里面简单不少。</p>
<p>Kivy自带的所有控件，都使用了这个图形接口；出于性能的考虑，此图形接口是用C语言来实现的。</p>
<p>这个图形接口的另一个好处是可以对你代码中的绘图指令进行自动优化。这个很有用，尤其是在你对OpenGL的优化不太熟悉的情况下。这能让你的绘图代码更高效。</p>
<p>当然了，你也可以坚持使用原生的OpenGL命令。目前Kivy在所有操作系统平台上用的都是是OpenGL 2.0 ES (GLES2)，所以如果你希望保持跨平台的兼容性，我们建议你只是用GLES2兼容的函数。</p>
<h2 id="核心模块">核心模块</h2>
<p>核心模块也就是kivy.core，这个包里面提供了常用的各种功能，比如：</p>
<ul>
<li>
<p>Clock</p>
<p>时钟类，可以用于安排计时器事件。同时支持一次性计时和周期性计时。</p>
</li>
<li>
<p>Cache</p>
<p>If you need to cache something that you use often, you can use our class for that instead of writing your own.</p>
<p>缓存类，如果有一些经常用到的数据需要缓存，就可以用这个类，而不用自己写了。</p>
</li>
<li>
<p>Gesture Detection</p>
<p>手势识别，这个可以用来识别各种划动行为，比如画个圆圈或者方块之类的。可以训练来识别你自己设计的图形。</p>
</li>
<li>
<p>Kivy Language</p>
<p>Kivy语言，这个是用来简洁高效地描述Kivy应用的用户界面的。</p>
</li>
<li>
<p>Properties</p>
<p>这里这些属性和Python语言中的属性不同。这里是我们专门写的一些类，通过用户界面描述来连接控件代码。</p>
</li>
</ul>
<h2 id="uix控件和布局">UIX（控件和布局）</h2>
<p>UIX用户界面模块，包含了常用的各种控件和布局，可以通过复用来快速构建用户界面。</p>
<ul>
<li>
<p>Widgets 控件</p>
<p>控件是各种用户界面元素，可以添加到程序中来提供各种功能。有的可见，有的不可见。文件浏览器，按钮、滑动页、列表等等，这都属于控件。控件接收动作事件。</p>
</li>
<li>
<p>Layouts 布局</p>
<p>布局是控件的排列方式。当然，你也可以自己自定义控件的位置，不过从我们提供的预设布局中选择一个来使用，会更方便很多。网格布局、箱式布局等等，都是布局了。你还可以试试复杂的多层网状布局。</p>
</li>
</ul>
<h2 id="模块化">模块化</h2>
<p>如果你用某一种现代的网络浏览器，并且通过一些附加组件对其进行定制，那么你应该就理解了我们提供的各种模块类的基本思想了。各种模块可以用来向Kivy程序中添加功能，即便原作者没有提供的功能也可以加进去了。</p>
<p>例如，有一个模块就能显示当前应用的FPS（Frame Per Second，每秒帧数，即帧率），然后还能统计一段时间的FPS变化。</p>
<p>你可以自己写各种模块添加到应用中。</p>
<h2 id="输入事件touches">输入事件（Touches）</h2>
<p>Kivy抽象了各种输入类型和输入设备，比如触控，鼠标按键，多点触摸等等。这些输入类型有一个共同点，就是都可以把各种输入事件映射成屏幕上对应的一种2D形态。（当然了，还有的输入设备就没法用2D形态来表示，比如通过加速度传感器来衡量设备倾斜角度等。这种情况就得另外考虑了。下面我们讨论的只是那些能用2D形态表示的输入事件，复杂的类型以后再说。）</p>
<p>这些输入类型，在Kivy中都用Touch()类的实例来表示。（请注意，这里可不仅仅是针对手指去触摸的那种touch，而是所有可以这样抽象表示的输入事件。这里用<strong>Touch</strong>只是为了方便而这么简称一下。就想象一下，这些<strong>Touches</strong>就是在用户界面或者显示屏上面的那些个<strong>点击行为</strong>。 ）Touch的实例或者对象，有三种状态。当这个Touch进入了其中的某一个状态，你的程序就会被告知此事件的发生。Touch的三种状态如下：</p>
<ul>
<li>
<p>Down 落下</p>
<p>处于落下状态，只能有一次，就是在发生Touch事件的初始时刻。</p>
</li>
<li>
<p>Move 移动</p>
<p>这个状态的时间无上限。在一个Touch的生命周期中可以没有这个状态。移动状态只发生在Touch的2D平面位置发生变化的情况下。</p>
</li>
<li>
<p>Up 抬起</p>
<p>A touch goes up at most once, or never. In practice you will almost always receive an up event because nobody is going to hold a finger on the screen for all eternity, but it is not guaranteed. If you know the input sources your users will be using, you will know whether or not you can rely on this state being entered.</p>
<p>一个Touch要么只能抬起一次，要么就不发生。而实际应用中你会经常遇到Up时间，因为没有人会一直把手指按到屏幕上，不过也有未必就绝对不会有这种情况。若事先知道用户用的输入设备，就可以确定能否完全依靠用户的输入状态。</p>
<p>（译者注：以手指触摸屏幕为例，只有开始接触的时候是Down手指落下这个状态，之后移动就是接下来的Move移动状态，手指抬起来的时候就是Up即抬起状态了；如果以鼠标左键点击为例，按下去左键的时候是Down，按住左键不放进行拖动就是Move，松开左键就是Up了。这段我特别解释一下，因为自己翻译的太生硬了。）</p>
</li>
</ul>
<h2 id="控件和事件调度">控件和事件调度</h2>
<p>在图形化的软件开发语境下，<strong>控件</strong>这个词经常出现，一般是来描述程序中用于和用户进行交互的组件。在Kivy中，控件是用来接收各种输入事件的。所以并不一定非要在屏幕上能看得到。Kivy当中所有控件都以<strong>控件树</strong>的形式来管理，学过计算机科学中数据结构相关知识的话，就会意识到这是一种树形结构：一个控件可以有任意多个子控件，也可以没有子控件。<strong>根控件</strong>就只能有一个，处于树形结构的顶端，根控件不具有父控件，并且所有其他控件都是根控件的直接或者间接子控件（就像树根一样，所以叫根控件）。</p>
<p>当新的输入数据可用的时候，Kivy会针对每一个Touch发出一个事件。控件树种的根控件首先接收到这个事件。Touch的不同状态，on_touch_down, on_touch_move和on_touch_up （Down落下、Move移动和Up），会作为Touch的参数，提供给根控件，根控件会调用对应的事件Handler来作出反应。</p>
<p>包括根控件在内，控件树种的每个控件都可以有两种选择，处理该事件，或者将该事件传递下去。如果一个事件的Handler返回True，就意味着这个事件已经被接收并妥善处理。这个事件就也到此为止了。如果不是这样，事件的Handler会跳过此处的空间，调用父类中的对应事件的Handler实现，传递给该控件的子控件。这样的过程可以一路走到最基础的控件类Widget，在它的Touch事件Handler中，只是把Touch传递给子控件，而不进行其他的操作。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># This is analogous for move/up:</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">on_touch_down</span>(<span style="color:#999">self</span>, touch):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> child <span style="color:#000;font-weight:bold">in</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>children[:]:
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> child<span style="color:#000;font-weight:bold">.</span>dispatch(<span style="color:#d14">&#39;on_touch_down&#39;</span>, touch):
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">True</span>
</span></span></code></pre></div><p>说起来挺麻烦，看上去挺复杂，实际上要简单得多。下一章就会讲解如何使用这种特性来快速创建应用了。</p>
<p>经常有一种情况，就是你可能要让一个控件只在屏幕上某个特定的<strong>区域</strong>来监听Touch事件。这时候就可以使用控件的collide_point()方法来实现此目的。只需要把Touch的位置发给该方法，然后如果此位置位于<strong>监听区域</strong>则返回True，反之返回False。默认情况下，这个方法会监听屏幕上的一个矩形区域，根据控件的中心坐标（x &amp; y坐标系），以及空间尺寸（宽度和高度），不过你也可以用自己的类覆盖掉这一行为。</p>
<p>Title: Kivy Widgets Date: 2017-02-26 Category: Kivy Tags: Python,Kivy</p>
<h1 id="控件">控件</h1>
<p><a href="https://kivy.org/docs/guide/widgets.html">英文原文</a></p>
<h2 id="控件简介">控件简介</h2>
<p><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件<code>Widget</code></a>是 Kivy 图形界面中的基本元素。控件提供了一个<a href="https://kivy.org/docs/api-kivy.graphics.html#kivy.graphics.Canvas" title="kivy.graphics.Canvas">画布<code>Canvas</code></a>，这是用来在屏幕上进行绘制的。控件接收事件，并且对事件作出反应。想要对 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件<code>Widget</code></a>进行更深入的了解，可以去看看这个模块的文档。</p>
<h2 id="操作控件树">操作控件树</h2>
<p>Kivy 以树的形式来组织控件。你的应用程序会有一个根控件，通常会含有若干的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件 <code>children</code></a>，这些子控件还可以有自己的子控件。一个控件的子控件会以 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children"><code>children</code></a>属性的形式表述，这个属性是 Kivy 中的一个<a href="https://kivy.org/docs/api-kivy.properties.html#kivy.properties.ListProperty" title="kivy.properties.ListProperty">列表属性 <code>ListProperty</code></a></p>
<p>可以用一下方法来操作控件树：</p>
<ul>
<li><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.add_widget" title="kivy.uix.widget.Widget.add_widget"><code>add_widget()</code></a>: 添加一个控件作为子控件；</li>
<li><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.remove_widget" title="kivy.uix.widget.Widget.remove_widget"><code>remove_widget()</code></a>: 从子控件列表中去掉一个控件；</li>
<li><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.clear_widgets" title="kivy.uix.widget.Widget.clear_widgets"><code>clear_widgets()</code></a>: 清空一个控件的所有子控件。</li>
</ul>
<p>例如下面的代码，就是在一个盒式布局 BoxLayout 中添加一个按钮：</p>
<pre tabindex="0"><code>layout = BoxLayout(padding=&lt;span&gt;10&lt;/span&gt;)
button = Button(text=&lt;span&gt;&#39;My first button&#39;&lt;/span&gt;)
layout.add_widget(button)
</code></pre><p>这个按钮就添加到布局当中去了：按钮的 parent 属性会被设置为这个布局；这个按钮也会被添加到布局中的子控件列表。要把这个按钮从这个布局中删掉也很简单：</p>
<pre tabindex="0"><code>layout.remove_widget(button)
</code></pre><p>移除了之后，这个按钮的 parent 属性就会被设置为 None，也会被从布局的子控件列表中移除。</p>
<p>要是想清空一个控件中的所有自科技，那就用 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.clear_widgets" title="kivy.uix.widget.Widget.clear_widgets"><code>clear_widgets()</code></a>方法就可以了：</p>
<pre tabindex="0"><code>layout.clear_widgets()
</code></pre><h4 id="特别注意-1">特别注意</h4>
<p>千万别自己手动去操作子控件列表，除非你确定自己掌控得非常深入透彻。因为控件树是和绘图树联系在一起的。例如，如果你添加了一个控件到子控件列表，但没有添加这个新子控件的画布到绘图树上，那么就会出现这种情况：这个控件确实成了一个子控件，但是屏幕上不会显示出来。此外，如果你后续使用添加、移除、清空控件这些操作，可能还会遇到问题。</p>
<h2 id="遍历控件树">遍历控件树</h2>
<p>控件类实例的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件<code>children</code></a>列表属性中包含了所有的子控件。所以可以用如下的方式来进行遍历：</p>
<pre tabindex="0"><code>root = BoxLayout()
&lt;span&gt;# ... add widgets to root ...&lt;/span&gt;
&lt;span&gt;for&lt;/span&gt; child &lt;span&gt;in&lt;/span&gt; root.children:
    print(child)
</code></pre><p>然而，这样的操作可得谨慎使用。如果你要用之前一节中提到的方法来修改这个子控件列表电话，请一定用下面这种方法来做一下备份：</p>
<pre tabindex="0"><code>&lt;span&gt;for&lt;/span&gt; child &lt;span&gt;in&lt;/span&gt; root.children[:]:
    &lt;span&gt;# manipulate the tree. For example here, remove all widgets that have a&lt;/span&gt;
    &lt;span&gt;# width&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; child.width  &lt;span&gt;100&lt;/span&gt;:
        root.remove_widget(child)
</code></pre><p>默认情况下，控件是不会对子控件的尺寸/位置进行改变的。<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" title="kivy.uix.widget.Widget.pos">位置属性 <code>pos</code></a>是屏幕坐标系上的绝对值（除非你使用<a href="https://kivy.org/docs/api-kivy.uix.relativelayout.html#module-kivy.uix.relativelayout" title="kivy.uix.relativelayout">相对布局<code>relativelayout</code></a>，这个以后再说），而<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size" title="kivy.uix.widget.Widget.size">尺寸属性 <code>size</code></a>就是一个绝对的尺寸大小。</p>
<h2 id="控件索引z">控件索引Z</h2>
<p>控件绘制的顺序，是基于各个控件在控件树中的位置。<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.add_widget" title="kivy.uix.widget.Widget.add_widget">添加控件方法 <code>add_widget</code></a> 可以接收一个索引参数，这样就能指定该新增控件在控件树中的位置。</p>
<pre tabindex="0"><code>root.add_widget(widget, index)
</code></pre><p>索引值小的控件会被绘制在索引值大的控件之上。一定要记住，默认值是 0 ，所以后添加的控件总会在所有控件的最顶层，除非指定了索引值。</p>
<h2 id="整理布局">整理布局</h2>
<p><a href="https://kivy.org/docs/api-kivy.uix.layout.html#module-kivy.uix.layout" title="kivy.uix.layout">布局 <code>layout</code></a>是一种特别的控件，它会控制自己子控件的尺寸和位置。有各种不同的布局，这些布局分别为子控件提供拜托你个的自动组织整理。这些布局使用<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint">尺寸推测 <code>size_hint</code></a>和<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos_hint" title="kivy.uix.widget.Widget.pos_hint">位置推测 <code>pos_hint</code></a>这两个属性来决定<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件<code>children</code></a>的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size" title="kivy.uix.widget.Widget.size">尺寸 <code>size</code></a> 和 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" title="kivy.uix.widget.Widget.pos">位置<code>pos</code></a>。</p>
<p><strong>盒式布局 BoxLayout</strong>: 所有控件充满整个空间，以互相挨着的方块的方式来分布，横着或者竖着排列都可以。子控件的 size_hint 属性可以用来改变每个子控件的比例，也可以设置为固定尺寸。</p>
<p><img src="https://kivy.org/docs/_images/boxlayout1.gif" alt="../_images/boxlayout1.gif"> <img src="https://kivy.org/docs/_images/gridlayout1.gif" alt="../_images/gridlayout1.gif"> <img src="https://kivy.org/docs/_images/stacklayout1.gif" alt="../_images/stacklayout1.gif"> <img src="https://kivy.org/docs/_images/anchorlayout1.gif" alt="../_images/anchorlayout1.gif"><img src="https://kivy.org/docs/_images/floatlayout1.gif" alt="../_images/floatlayout1.gif"></p>
<p><strong>网格布局 GridLayout</strong>: 以一张网格的方式来安排控件。你必须指定好网格的维度，确定好分成多少格，这样 Kivy 才能计算出每个元素的尺寸并且确定如何安排这些元素的位置。</p>
<p><strong>栈状布局 StackLayout</strong>: 挨着放一个个控件，彼此邻近，在某一个维度上有固定大小，而使它们填充整个空间。 这适合用来显示相同预定义大小的子控件。</p>
<p><strong>锚式布局 AnchorLayout</strong>: 一种非常简单的布局，只关注子控件的位置。 将子控件放在布局的边界位置。 不支持size_hint。</p>
<p><strong>浮动布局 FloatLayout</strong>: 允许放置具任意位置和尺寸的子控件，可以是绝对尺寸，也可以是相对布局的相对尺寸。 默认的 size_hint（1，1）会让每个子控件都与整个布局一样大，所以如果你多个子控件就要修改这个值。可以把 size_hint 设置成 (None, None)，这样就可以使用 size 这个绝对尺寸属性。控件也支持 pos_hint，这个属性是一个 dict 词典，用来设置相对布局的位置。</p>
<p><strong>相对布局 RelativeLayout</strong>: 和浮动布局 FloatLayout 差不多，不同之处在于子控件的位置是相对于布局空间的，而不是相对于屏幕。</p>
<p>想要深入理解各种布局的话，可以仔细阅读各种文档。</p>
<p><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a> 和 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos_hint" title="kivy.uix.widget.Widget.pos_hint"><code>pos_hint</code></a>:</p>
<ul>
<li><a href="https://kivy.org/docs/api-kivy.uix.floatlayout.html#module-kivy.uix.floatlayout" title="kivy.uix.floatlayout"><code>floatlayout</code></a></li>
<li><a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#module-kivy.uix.boxlayout" title="kivy.uix.boxlayout"><code>boxlayout</code></a></li>
<li><a href="https://kivy.org/docs/api-kivy.uix.gridlayout.html#module-kivy.uix.gridlayout" title="kivy.uix.gridlayout"><code>gridlayout</code></a></li>
<li><a href="https://kivy.org/docs/api-kivy.uix.stacklayout.html#module-kivy.uix.stacklayout" title="kivy.uix.stacklayout"><code>stacklayout</code></a></li>
<li><a href="https://kivy.org/docs/api-kivy.uix.relativelayout.html#module-kivy.uix.relativelayout" title="kivy.uix.relativelayout"><code>relativelayout</code></a></li>
<li><a href="https://kivy.org/docs/api-kivy.uix.anchorlayout.html#module-kivy.uix.anchorlayout" title="kivy.uix.anchorlayout"><code>anchorlayout</code></a></li>
</ul>
<p><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a> 是一个 <a href="https://kivy.org/docs/api-kivy.properties.html#kivy.properties.ReferenceListProperty" title="kivy.properties.ReferenceListProperty">引用列表属性 <code>ReferenceListProperty</code></a> ，包括 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a> 和<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_y" title="kivy.uix.widget.Widget.size_hint_y"><code>size_hint_y</code></a> 两个变量。接收的变量值是从0到1的各种数值，或者 None， 默认值为 (1, 1)。这表示如果控件处在布局之内，布局将会在两个方向分配全部尺寸（相对于布局大小）给该控件。</p>
<p>举个例子，设置<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a> 为 (0.5, 0.8)，就会给该<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件<code>Widget</code></a> 分配<a href="https://kivy.org/docs/api-kivy.uix.layout.html#module-kivy.uix.layout" title="kivy.uix.layout">布局 <code>layout</code></a> 内50% 宽，80% 高的尺寸。</p>
<p>例如下面这个例子：</p>
<pre tabindex="0"><code>BoxLayout:
    Button:
        text: &lt;span&gt;&#39;Button 1&#39;&lt;/span&gt;
        &lt;span&gt;# default size_hint is 1, 1, we don&#39;t need to specify it explicitly&lt;/span&gt;
        &lt;span&gt;# however it&#39;s provided here to make things clear&lt;/span&gt;
        size_hint: &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;
</code></pre><p>加载 Kivy 目录：</p>
<pre tabindex="0"><code>cd $KIVYDIR/examples/demo/kivycatalog
python main.py
</code></pre><p>把上面代码中的 $KIVYDIR 替换成你的 Kivy 安装位置。在左边点击标注有 Box Layout 的按钮。 然后将上面的代码粘贴到窗口右侧的编辑器内。</p>
<p><img src="https://kivy.org/docs/_images/size_hint%5BB%5D.jpg" alt="../_images/size_hint[B].jpg"></p>
<p>然后你就可以看到上图这样的界面了，这个按钮 Button 会占据整个布局<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size" title="kivy.uix.widget.Widget.size">尺寸 <code>size</code></a>的 100%。</p>
<p>修改<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a>/<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_y" title="kivy.uix.widget.Widget.size_hint_y"><code>size_hint_y</code></a> 为 .5 这就会把<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件 <code>Widget</code></a> 调整为<a href="https://kivy.org/docs/api-kivy.uix.layout.html#module-kivy.uix.layout" title="kivy.uix.layout">布局 <code>layout</code></a> 的50% <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.width" title="kivy.uix.widget.Widget.width">宽度 <code>width</code></a>/<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.height" title="kivy.uix.widget.Widget.height">高度 <code>height</code></a>。</p>
<p><img src="https://kivy.org/docs/_images/size_hint%5Bb_%5D.jpg" alt="../images/size_hint[b].jpg"></p>
<p>这时候效果如上图所示，虽然我们已经同时指定了 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a> 和 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_y" title="kivy.uix.widget.Widget.size_hint_y"><code>size_hint_y</code></a> 为 .5，但似乎只有对 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a> 的修改起作用了。这是因为在<a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#module-kivy.uix.boxlayout" title="kivy.uix.boxlayout">盒式布局 <code>boxlayout</code></a>中，当<a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#kivy.uix.boxlayout.BoxLayout.orientation" title="kivy.uix.boxlayout.BoxLayout.orientation"><code>orientation</code></a>被设置为竖直方向（vertical） 的时候，<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_y" title="kivy.uix.widget.Widget.size_hint_y"><code>size_hint_y</code></a> 由布局来控制，而如果<a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#kivy.uix.boxlayout.BoxLayout.orientation" title="kivy.uix.boxlayout.BoxLayout.orientation"><code>orientation</code></a> 被设置为水平方向（horizontal）的时候， <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a> 由布局来控制，所以这些情况手动设定就无效了。 这些受控维度的尺寸，是根据<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件 <code>children</code></a> 在 <a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#module-kivy.uix.boxlayout" title="kivy.uix.boxlayout"><code>盒式布局 boxlayout</code></a>中的总编号来计算的。在上面的例子中，这个子控件的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_y" title="kivy.uix.widget.Widget.size_hint_y"><code>size_hint_y</code></a> 是受控的(.5/.5 = 1)。所以，这里控件就占据了上层布局的整个高度。</p>
<p>接下来咱们再添加一个<a href="https://kivy.org/docs/api-kivy.uix.button.html#kivy.uix.button.Button" title="kivy.uix.button.Button">按钮 <code>Button</code></a>到这个 <a href="https://kivy.org/docs/api-kivy.uix.layout.html#module-kivy.uix.layout" title="kivy.uix.layout">布局 <code>layout</code></a>看看有什么效果。</p>
<p><img src="https://kivy.org/docs/_images/size_hint%5Bbb%5D.jpg" alt="../_images/size_hint[bb].jpg"></p>
<p><a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#module-kivy.uix.boxlayout" title="kivy.uix.boxlayout">盒式布局 <code>boxlayout</code></a> 默认对其所有的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件 <code>children</code></a>分配了等大的空间。在咱们这个例子里面，比例是50-50，因为有两个<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件 <code>children</code></a>。那么接下来咱们就对其中的一个子控件设置一下 size_hint，然后看看效果怎么样。</p>
<p><img src="https://kivy.org/docs/_images/size_hint%5BoB%5D.jpg" alt="../_images/size_hint[oB].jpg"></p>
<p>从上图可以看出，如果一个子控件有了一个指定的 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a>，这就会决定该<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件 <code>Widget</code></a>使用<a href="https://kivy.org/docs/api-kivy.uix.boxlayout.html#module-kivy.uix.boxlayout" title="kivy.uix.boxlayout">盒式布局 <code>boxlayout</code></a>提供的空间中的多大比例，来作为自己的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size" title="kivy.uix.widget.Widget.size">尺寸 <code>size</code></a> 。在我们这个例子中，第一个<a href="https://kivy.org/docs/api-kivy.uix.button.html#kivy.uix.button.Button" title="kivy.uix.button.Button">按钮 <code>Button</code></a> 的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a>设置为了 .5。那么这个控件分配到的空间计算方法如下：</p>
<pre tabindex="0"><code>first child&#39;s size_hint divided by
first child&#39;s size_hint + second child&#39;s size_hint + ...n(no of children)

.5/(.5+1) = .333...
</code></pre><p>盒式布局 BoxLayout 的剩余<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.width" title="kivy.uix.widget.Widget.width">宽度 <code>width</code></a>会分配给另外的一个<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.children" title="kivy.uix.widget.Widget.children">子控件 <code>children</code></a>。在我们这个例子中，这就意味着第二个<a href="https://kivy.org/docs/api-kivy.uix.button.html#kivy.uix.button.Button" title="kivy.uix.button.Button">按钮 <code>Button</code></a> 会占据整个<a href="https://kivy.org/docs/api-kivy.uix.layout.html#module-kivy.uix.layout" title="kivy.uix.layout">布局 <code>layout</code></a>的 66.66% <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.width" title="kivy.uix.widget.Widget.width">宽度 <code>width</code></a> 。</p>
<p>修改 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a> 探索一下来多适应一下吧。</p>
<p>如果你想要控制一个<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件 <code>Widget</code></a>的绝对<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size" title="kivy.uix.widget.Widget.size">尺寸 <code>size</code></a> ，可以把<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_x" title="kivy.uix.widget.Widget.size_hint_x"><code>size_hint_x</code></a>/<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint_y" title="kivy.uix.widget.Widget.size_hint_y"><code>size_hint_y</code></a>当中的一个或者两个都设置成 None，这样的话该控件的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.width" title="kivy.uix.widget.Widget.width">宽度 <code>width</code></a> 和<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.height" title="kivy.uix.widget.Widget.height">高度 <code>height</code></a>的属性值就会生效了。</p>
<p><a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos_hint" title="kivy.uix.widget.Widget.pos_hint"><code>pos_hint</code></a> 是一个词典 dict，默认值是空。相比于<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a>，布局对<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos_hint" title="kivy.uix.widget.Widget.pos_hint"><code>pos_hint</code></a>的处理方式有些不同，不过大体上你还是可以对<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" title="kivy.uix.widget.Widget.pos"><code>pos</code></a> 的各种属性设定某个值来设定<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget" title="kivy.uix.widget.Widget">控件 <code>Widget</code></a>在<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.parent" title="kivy.uix.widget.Widget.parent">父控件 <code>parent</code></a>中的相对位置（可以设定的属性包括：<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.x" title="kivy.uix.widget.Widget.x"><code>x</code></a>, <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.y" title="kivy.uix.widget.Widget.y"><code>y</code></a>, <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.right" title="kivy.uix.widget.Widget.right"><code>right</code></a>, <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.top" title="kivy.uix.widget.Widget.top"><code>top</code></a>, <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.center_x" title="kivy.uix.widget.Widget.center_x"><code>center_x</code></a>, <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.center_y" title="kivy.uix.widget.Widget.center_y"><code>center_y</code></a>）。</p>
<p>咱们用下面 kivycatalog 中的代码来可视化地理解一下<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos_hint" title="kivy.uix.widget.Widget.pos_hint"><code>pos_hint</code></a>：</p>
<pre tabindex="0"><code>FloatLayout:
    Button:
        text: &lt;span&gt;&#34;We Will&#34;&lt;/span&gt;
        pos: &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;100&lt;/span&gt;
        size_hint: &lt;span&gt;.2&lt;/span&gt;, &lt;span&gt;.4&lt;/span&gt;
    Button:
        text: &lt;span&gt;&#34;Wee Wiill&#34;&lt;/span&gt;
        pos: &lt;span&gt;200&lt;/span&gt;, &lt;span&gt;200&lt;/span&gt;
        size_hint: &lt;span&gt;.4&lt;/span&gt;, &lt;span&gt;.2&lt;/span&gt;

    Button:
        text: &lt;span&gt;&#34;ROCK YOU!!&#34;&lt;/span&gt;
        pos_hint: {&lt;span&gt;&#39;x&#39;&lt;/span&gt;: &lt;span&gt;.3&lt;/span&gt;, &lt;span&gt;&#39;y&#39;&lt;/span&gt;: &lt;span&gt;.6&lt;/span&gt;}
        size_hint: &lt;span&gt;.5&lt;/span&gt;, &lt;span&gt;.2&lt;/span&gt;
</code></pre><p>这份代码的输出效果如下图所示：</p>
<p><img src="https://kivy.org/docs/_images/pos_hint.jpg" alt="../_images/pos_hint.jpg"></p>
<p>说了半天<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size_hint" title="kivy.uix.widget.Widget.size_hint"><code>size_hint</code></a>，你不妨自己试试探索一下 <a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos_hint" title="kivy.uix.widget.Widget.pos_hint"><code>pos_hint</code></a>，来理解一下这个属性对控件位置的效果。</p>
<h2 id="给布局添加背景">给布局添加背景</h2>
<p>关于布局，有一个问题经常被问道：</p>
<p>“怎么给一个布局添加背景图片/颜色/视频/等等&hellip;&hellip;”</p>
<p>本来默认的各种布局都是没有视觉呈现的：因为布局不像控件，布局是默认不含有绘图指令的。不过呢，还是你可以给一个布局实例添上绘图指令，也就可以添加一个彩色背景了：</p>
<p>在 Python 中的实现方法：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.graphics &lt;span&gt;import&lt;/span&gt; Color, Rectangle

&lt;span&gt;with&lt;/span&gt; layout_instance.canvas.before:
    Color(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;) &lt;span&gt;# green; colors range from 0-1 instead of 0-255&lt;/span&gt;
    self.rect = Rectangle(size=layout_instance.size,
                           pos=layout_instance.pos)
</code></pre><p>然而很不幸，这样只能在布局的初始化位置以布局的初始尺寸绘制一个矩形。所以还要对布局的尺寸和位置变化进行监听，然后对矩形的尺寸位置进行更新，这样才能保证这个矩形一直绘制在布局的内部。可以用如下方式实现：</p>
<pre tabindex="0"><code>&lt;span&gt;with&lt;/span&gt; layout_instance.canvas.before:
    Color(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;) &lt;span&gt;# green; colors range from 0-1 instead of 0-255&lt;/span&gt;
    self.rect = Rectangle(size=layout_instance.size,
                           pos=layout_instance.pos)

&lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;update_rect&lt;/span&gt;&lt;span&gt;(instance, value)&lt;/span&gt;:&lt;/span&gt;
    instance.rect.pos = instance.pos
    instance.rect.size = instance.size

&lt;span&gt;# listen to size and position changes&lt;/span&gt;
layout_instance.bind(pos=update_rect, size=update_rect)
</code></pre><p>在 kv 文件中：</p>
<pre tabindex="0"><code>FloatLayout:
    canvas.before:
        Color:
            rgba: &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;
        Rectangle:
            &lt;span&gt;# self here refers to the widget i.e BoxLayout&lt;/span&gt;
            pos: self.pos
            size: self.size
</code></pre><p>上面的 Kv 文件中的生命，就建立了一个隐含的绑定：上面 Kv 代码中的最后两行保证了矩形的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" title="kivy.uix.widget.Widget.pos">位置 <code>pos</code></a>和<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.size" title="kivy.uix.widget.Widget.size">尺寸 <code>size</code></a>会在<a href="https://kivy.org/docs/api-kivy.uix.floatlayout.html#module-kivy.uix.floatlayout" title="kivy.uix.floatlayout">浮动布局 <code>floatlayout</code></a>的<a href="https://kivy.org/docs/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" title="kivy.uix.widget.Widget.pos">位置 <code>pos</code></a>发生变化的时候进行更新。</p>
<p>接下来咱们把上面的代码片段放进 Kivy 应用里面。</p>
<p>纯 Python 方法：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.app &lt;span&gt;import&lt;/span&gt; App
&lt;span&gt;from&lt;/span&gt; kivy.graphics &lt;span&gt;import&lt;/span&gt; Color, Rectangle
&lt;span&gt;from&lt;/span&gt; kivy.uix.floatlayout &lt;span&gt;import&lt;/span&gt; FloatLayout
&lt;span&gt;from&lt;/span&gt; kivy.uix.button &lt;span&gt;import&lt;/span&gt; Button

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RootWidget&lt;/span&gt;&lt;span&gt;(FloatLayout)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;&lt;span&gt;(self, **kwargs)&lt;/span&gt;:&lt;/span&gt;
        &lt;span&gt;# make sure we aren&#39;t overriding any important functionality&lt;/span&gt;
        super(RootWidget, self).__init__(**kwargs)

        &lt;span&gt;# let&#39;s add a Widget to this layout&lt;/span&gt;
        self.add_widget(
            Button(
                text=&lt;span&gt;&#34;Hello World&#34;&lt;/span&gt;,
                size_hint=(&lt;span&gt;.5&lt;/span&gt;, &lt;span&gt;.5&lt;/span&gt;),
                pos_hint={&lt;span&gt;&#39;center_x&#39;&lt;/span&gt;: &lt;span&gt;.5&lt;/span&gt;, &lt;span&gt;&#39;center_y&#39;&lt;/span&gt;: &lt;span&gt;.5&lt;/span&gt;}))

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;MainApp&lt;/span&gt;&lt;span&gt;(App)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;build&lt;/span&gt;&lt;span&gt;(self)&lt;/span&gt;:&lt;/span&gt;
        self.root = root = RootWidget()
        root.bind(size=self._update_rect, pos=self._update_rect)

        &lt;span&gt;with&lt;/span&gt; root.canvas.before:
            Color(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;)  &lt;span&gt;# green; colors range from 0-1 not 0-255&lt;/span&gt;
            self.rect = Rectangle(size=root.size, pos=root.pos)
        &lt;span&gt;return&lt;/span&gt; root

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;_update_rect&lt;/span&gt;&lt;span&gt;(self, instance, value)&lt;/span&gt;:&lt;/span&gt;
        self.rect.pos = instance.pos
        self.rect.size = instance.size

&lt;span&gt;if&lt;/span&gt; __name__ == &lt;span&gt;&#39;__main__&#39;&lt;/span&gt;:
    MainApp().run()
</code></pre><p>使用 Kv 语言：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.app &lt;span&gt;import&lt;/span&gt; App
&lt;span&gt;from&lt;/span&gt; kivy.lang &lt;span&gt;import&lt;/span&gt; Builder


root = Builder.load_string(&lt;span&gt;&#39;&#39;&#39;
FloatLayout:
    canvas.before:
        Color:
            rgba: 0, 1, 0, 1
        Rectangle:
            # self here refers to the widget i.e FloatLayout
            pos: self.pos
            size: self.size
    Button:
        text: &#39;Hello World!!&#39;
        size_hint: .5, .5
        pos_hint: {&#39;center_x&#39;:.5, &#39;center_y&#39;: .5}
&#39;&#39;&#39;&lt;/span&gt;)

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;MainApp&lt;/span&gt;&lt;span&gt;(App)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;build&lt;/span&gt;&lt;span&gt;(self)&lt;/span&gt;:&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; root

&lt;span&gt;if&lt;/span&gt; __name__ == &lt;span&gt;&#39;__main__&#39;&lt;/span&gt;:
    MainApp().run()
</code></pre><p>上面这两个应用的效果都如下图所示： <img src="https://kivy.org/docs/_images/layout_background.png" alt="../_images/layout_background.png"></p>
<h3 id="给自定义布局规则类增加背景色">给<strong>自定义布局规则/类</strong>增加背景色</h3>
<p>上面那一段中咱们对布局实例增加背景的方法，如果用到很多歌布局里面，那就很快变得特别麻烦了。要解决这种需求，就可以基于布局类 Layout 创建一个自定义的布局子类，给自定义的这个类增加一个背景。</p>
<p>使用 Python：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.app &lt;span&gt;import&lt;/span&gt; App
&lt;span&gt;from&lt;/span&gt; kivy.graphics &lt;span&gt;import&lt;/span&gt; Color, Rectangle
&lt;span&gt;from&lt;/span&gt; kivy.uix.boxlayout &lt;span&gt;import&lt;/span&gt; BoxLayout
&lt;span&gt;from&lt;/span&gt; kivy.uix.floatlayout &lt;span&gt;import&lt;/span&gt; FloatLayout
&lt;span&gt;from&lt;/span&gt; kivy.uix.image &lt;span&gt;import&lt;/span&gt; AsyncImage

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RootWidget&lt;/span&gt;&lt;span&gt;(BoxLayout)&lt;/span&gt;:&lt;/span&gt;
    &lt;span&gt;pass&lt;/span&gt;

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;CustomLayout&lt;/span&gt;&lt;span&gt;(FloatLayout)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;&lt;span&gt;(self, **kwargs)&lt;/span&gt;:&lt;/span&gt;
        &lt;span&gt;# make sure we aren&#39;t overriding any important functionality&lt;/span&gt;
        super(CustomLayout, self).__init__(**kwargs)

        &lt;span&gt;with&lt;/span&gt; self.canvas.before:
            Color(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;)  &lt;span&gt;# green; colors range from 0-1 instead of 0-255&lt;/span&gt;
            self.rect = Rectangle(size=self.size, pos=self.pos)

        self.bind(size=self._update_rect, pos=self._update_rect)

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;_update_rect&lt;/span&gt;&lt;span&gt;(self, instance, value)&lt;/span&gt;:&lt;/span&gt;
        self.rect.pos = instance.pos
        self.rect.size = instance.size

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;MainApp&lt;/span&gt;&lt;span&gt;(App)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;build&lt;/span&gt;&lt;span&gt;(self)&lt;/span&gt;:&lt;/span&gt;
        root = RootWidget()
        c = CustomLayout()
        root.add_widget(c)
        c.add_widget(
            AsyncImage(
                source=&lt;span&gt;&#34;http://www.everythingzoomer.com/wp-content/uploads/2013/01/Monday-joke-289x277.jpg&#34;&lt;/span&gt;,
                size_hint= (&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;.5&lt;/span&gt;),
                pos_hint={&lt;span&gt;&#39;center_x&#39;&lt;/span&gt;:&lt;span&gt;.5&lt;/span&gt;, &lt;span&gt;&#39;center_y&#39;&lt;/span&gt;:&lt;span&gt;.5&lt;/span&gt;}))
        root.add_widget(AsyncImage(source=&lt;span&gt;&#39;http://www.stuffistumbledupon.com/wp-content/uploads/2012/05/Have-you-seen-this-dog-because-its-awesome-meme-puppy-doggy.jpg&#39;&lt;/span&gt;))
        c = CustomLayout()
        c.add_widget(
            AsyncImage(
                source=&lt;span&gt;&#34;http://www.stuffistumbledupon.com/wp-content/uploads/2012/04/Get-a-Girlfriend-Meme-empty-wallet.jpg&#34;&lt;/span&gt;,
                size_hint= (&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;.5&lt;/span&gt;),
                pos_hint={&lt;span&gt;&#39;center_x&#39;&lt;/span&gt;:&lt;span&gt;.5&lt;/span&gt;, &lt;span&gt;&#39;center_y&#39;&lt;/span&gt;:&lt;span&gt;.5&lt;/span&gt;}))
        root.add_widget(c)
        &lt;span&gt;return&lt;/span&gt; root

&lt;span&gt;if&lt;/span&gt; __name__ == &lt;span&gt;&#39;__main__&#39;&lt;/span&gt;:
    MainApp().run()
</code></pre><p>使用 Kv 语言：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.app &lt;span&gt;import&lt;/span&gt; App
&lt;span&gt;from&lt;/span&gt; kivy.uix.floatlayout &lt;span&gt;import&lt;/span&gt; FloatLayout
&lt;span&gt;from&lt;/span&gt; kivy.uix.boxlayout &lt;span&gt;import&lt;/span&gt; BoxLayout
&lt;span&gt;from&lt;/span&gt; kivy.lang &lt;span&gt;import&lt;/span&gt; Builder


Builder.load_string(&lt;span&gt;&#39;&#39;&#39;
&amp;lt;CustomLayout&amp;gt;
    canvas.before:
        Color:
            rgba: 0, 1, 0, 1
        Rectangle:
            pos: self.pos
            size: self.size

&amp;lt;RootWidget&amp;gt;
    CustomLayout:
        AsyncImage:
            source: &#39;http://www.everythingzoomer.com/wp-content/uploads/2013/01/Monday-joke-289x277.jpg&#39;
            size_hint: 1, .5
            pos_hint: {&#39;center_x&#39;:.5, &#39;center_y&#39;: .5}
    AsyncImage:
        source: &#39;http://www.stuffistumbledupon.com/wp-content/uploads/2012/05/Have-you-seen-this-dog-because-its-awesome-meme-puppy-doggy.jpg&#39;
    CustomLayout
        AsyncImage:
            source: &#39;http://www.stuffistumbledupon.com/wp-content/uploads/2012/04/Get-a-Girlfriend-Meme-empty-wallet.jpg&#39;
            size_hint: 1, .5
            pos_hint: {&#39;center_x&#39;:.5, &#39;center_y&#39;: .5}
&#39;&#39;&#39;&lt;/span&gt;)

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RootWidget&lt;/span&gt;&lt;span&gt;(BoxLayout)&lt;/span&gt;:&lt;/span&gt;
    &lt;span&gt;pass&lt;/span&gt;

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;CustomLayout&lt;/span&gt;&lt;span&gt;(FloatLayout)&lt;/span&gt;:&lt;/span&gt;
    &lt;span&gt;pass&lt;/span&gt;

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;MainApp&lt;/span&gt;&lt;span&gt;(App)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;build&lt;/span&gt;&lt;span&gt;(self)&lt;/span&gt;:&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; RootWidget()

&lt;span&gt;if&lt;/span&gt; __name__ == &lt;span&gt;&#39;__main__&#39;&lt;/span&gt;:
    MainApp().run()
</code></pre><p>上面这两个应用的效果都如下图所示：</p>
<p><img src="https://kivy.org/docs/_images/custom_layout_background.png" alt="../_images/custom_layout_background.png"></p>
<p>在自定义布局类中定义了背景之后，就是要确保在自定义布局的各个实例中使用到这个新特性。</p>
<p>首先，要在<strong>全局上</strong>增加一个图形或者颜色给内置的 Kivy 布局的背景，这就需要将所用布局的默认 Kv 规则进行覆盖。</p>
<p>就拿网格布局 GridLayout 举例吧：</p>
<pre tabindex="0"><code>&amp;lt;GridLayout&amp;gt;
    canvas.before:
        Color:
            rgba: &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;
        BorderImage:
            source: &lt;span&gt;&#39;../examples/widgets/sequenced_images/data/images/button_white.png&#39;&lt;/span&gt;
            pos: self.pos
            size: self.size
</code></pre><p>接下来把这段代码放到一个 Kivy 应用里面：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.app &lt;span&gt;import&lt;/span&gt; App
&lt;span&gt;from&lt;/span&gt; kivy.uix.floatlayout &lt;span&gt;import&lt;/span&gt; FloatLayout
&lt;span&gt;from&lt;/span&gt; kivy.lang &lt;span&gt;import&lt;/span&gt; Builder


Builder.load_string(&lt;span&gt;&#39;&#39;&#39;
&amp;lt;GridLayout&amp;gt;
    canvas.before:
        BorderImage:
            # BorderImage behaves like the CSS BorderImage
            border: 10, 10, 10, 10
            source: &#39;../examples/widgets/sequenced_images/data/images/button_white.png&#39;
            pos: self.pos
            size: self.size

&amp;lt;RootWidget&amp;gt;
    GridLayout:
        size_hint: .9, .9
        pos_hint: {&#39;center_x&#39;: .5, &#39;center_y&#39;: .5}
        rows:1
        Label:
            text: &#34;I don&#39;t suffer from insanity, I enjoy every minute of it&#34;
            text_size: self.width-20, self.height-20
            valign: &#39;top&#39;
        Label:
            text: &#34;When I was born I was so surprised; I didn&#39;t speak for a year and a half.&#34;
            text_size: self.width-20, self.height-20
            valign: &#39;middle&#39;
            halign: &#39;center&#39;
        Label:
            text: &#34;A consultant is someone who takes a subject you understand and makes it sound confusing&#34;
            text_size: self.width-20, self.height-20
            valign: &#39;bottom&#39;
            halign: &#39;justify&#39;
&#39;&#39;&#39;&lt;/span&gt;)

&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RootWidget&lt;/span&gt;&lt;span&gt;(FloatLayout)&lt;/span&gt;:&lt;/span&gt;
    &lt;span&gt;pass&lt;/span&gt;


&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;MainApp&lt;/span&gt;&lt;span&gt;(App)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;build&lt;/span&gt;&lt;span&gt;(self)&lt;/span&gt;:&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; RootWidget()

&lt;span&gt;if&lt;/span&gt; __name__ == &lt;span&gt;&#39;__main__&#39;&lt;/span&gt;:
    MainApp().run()
</code></pre><p>效果大概如下图所示：</p>
<p><img src="https://kivy.org/docs/_images/global_background.png" alt="../_images/global_background.png"></p>
<p>我们已经对网格布局 GridLayout 类的规则进行了覆盖，所以接下来在应用中使用这个类就都会显示那幅图片了。</p>
<p><strong>动画背景</strong>怎么弄呢？</p>
<p>就像在矩形Rectangle/ 边界图像BorderImage /椭圆Ellipse/等里面添加设置绘图指令一样，可以用一个特定的纹理属性 texture ：</p>
<pre tabindex="0"><code>Rectangle:
    texture: reference to a texture
</code></pre><p>可以用下面的代码实现一个动画背景：</p>
<pre tabindex="0"><code>&lt;span&gt;from&lt;/span&gt; kivy.app &lt;span&gt;import&lt;/span&gt; App
&lt;span&gt;from&lt;/span&gt; kivy.uix.floatlayout &lt;span&gt;import&lt;/span&gt; FloatLayout
&lt;span&gt;from&lt;/span&gt; kivy.uix.gridlayout &lt;span&gt;import&lt;/span&gt; GridLayout
&lt;span&gt;from&lt;/span&gt; kivy.uix.image &lt;span&gt;import&lt;/span&gt; Image
&lt;span&gt;from&lt;/span&gt; kivy.properties &lt;span&gt;import&lt;/span&gt; ObjectProperty
&lt;span&gt;from&lt;/span&gt; kivy.lang &lt;span&gt;import&lt;/span&gt; Builder


Builder.load_string(&lt;span&gt;&#39;&#39;&#39;
&amp;lt;CustomLayout&amp;gt;
    canvas.before:
        BorderImage:
            # BorderImage behaves like the CSS BorderImage
            border: 10, 10, 10, 10
            texture: self.background_image.texture
            pos: self.pos
            size: self.size

&amp;lt;RootWidget&amp;gt;
    CustomLayout:
        size_hint: .9, .9
        pos_hint: {&#39;center_x&#39;: .5, &#39;center_y&#39;: .5}
        rows:1
        Label:
            text: &#34;I don&#39;t suffer from insanity, I enjoy every minute of it&#34;
            text_size: self.width-20, self.height-20
            valign: &#39;top&#39;
        Label:
            text: &#34;When I was born I was so surprised; I didn&#39;t speak for a year and a half.&#34;
            text_size: self.width-20, self.height-20
            valign: &#39;middle&#39;
            halign: &#39;center&#39;
        Label:
            text: &#34;A consultant is someone who takes a subject you understand and makes it sound confusing&#34;
            text_size: self.width-20, self.height-20
            valign: &#39;bottom&#39;
            halign: &#39;justify&#39;
&#39;&#39;&#39;&lt;/span&gt;)


&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;CustomLayout&lt;/span&gt;&lt;span&gt;(GridLayout)&lt;/span&gt;:&lt;/span&gt;

    background_image = ObjectProperty(
        Image(
            source=&lt;span&gt;&#39;../examples/widgets/sequenced_images/data/images/button_white_animated.zip&#39;&lt;/span&gt;,
            anim_delay=&lt;span&gt;.1&lt;/span&gt;))


&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;RootWidget&lt;/span&gt;&lt;span&gt;(FloatLayout)&lt;/span&gt;:&lt;/span&gt;
    &lt;span&gt;pass&lt;/span&gt;


&lt;span&gt;&lt;span&gt;class&lt;/span&gt; &lt;span&gt;MainApp&lt;/span&gt;&lt;span&gt;(App)&lt;/span&gt;:&lt;/span&gt;

    &lt;span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;build&lt;/span&gt;&lt;span&gt;(self)&lt;/span&gt;:&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; RootWidget()

&lt;span&gt;if&lt;/span&gt; __name__ == &lt;span&gt;&#39;__main__&#39;&lt;/span&gt;:
    MainApp().run()
</code></pre><p>要理解这里到底发生了什么，得从第 13 行开始看：</p>
<pre tabindex="0"><code>texture: self.background_image.texture
</code></pre><p>这里是指定让边界图像 BorderImage 的纹理属性在背景图像 background_image 的纹理属性发生更新的时候进行同步更新。背景图像 background_image 属性的定义是在第 40 行：</p>
<pre tabindex="0"><code>background_image = ObjectProperty(...
</code></pre><p>这一句代码是将背景图像 background_image 设置成一个<a href="https://kivy.org/docs/api-kivy.properties.html#kivy.properties.ObjectProperty" title="kivy.properties.ObjectProperty">对象属性 <code>ObjectProperty</code></a>，这样就可以在其中添加一个<a href="https://kivy.org/docs/api-kivy.uix.image.html#kivy.uix.image.Image" title="kivy.uix.image.Image">图形控件 <code>Image</code></a>。图像控件有一个纹理属性（texture property）；在前面的 self.background_image.texture 这句代码中，就是建立了一个名为 texture 的到这个属性的引用。<a href="https://kivy.org/docs/api-kivy.uix.image.html#kivy.uix.image.Image" title="kivy.uix.image.Image">图形控件 <code>Image</code></a> 支持动画（animation）：随着动画的改变，图像的纹理会同步更新，在这个过程中，边界图像 BorderImage 指令的 texture 纹理属性也会同步更新。</p>
<p>（译者注：texture of BorderImage instruction，这里我对 instruction 的翻译应该是不太对的，不过我还没理清楚该怎么表述。）</p>
<p>也可以直接传递自定义数据到纹理属性 texture。更多细节可以参考<a href="https://kivy.org/docs/api-kivy.graphics.texture.html#kivy.graphics.texture.Texture" title="kivy.graphics.texture.Texture">纹理 <code>Texture</code> 的文档</a>。</p>
<h2 id="网状布局">网状布局</h2>
<p>嗯，看看这个过程如何扩展是很有趣的。</p>
<h2 id="尺寸和位置度量">尺寸和位置度量</h2>
<p>Kivy 的默认长度单位是像素 pixel，所有的尺寸和位置都用这个单位来表达。你也可以用其他单位来衡量，在跨平台多种设备的时候，这有助于实现更好的连续性体验（这些设备会把尺寸自动转换到像素）。</p>
<p>可用单位包括 <a href="https://kivy.org/docs/api-kivy.metrics.html#kivy.metrics.pt" title="kivy.metrics.pt"><code>pt</code></a>， <a href="https://kivy.org/docs/api-kivy.metrics.html#kivy.metrics.mm" title="kivy.metrics.mm"><code>mm</code></a>，<a href="https://kivy.org/docs/api-kivy.metrics.html#kivy.metrics.cm" title="kivy.metrics.cm"><code>cm</code></a>, <a href="https://kivy.org/docs/api-kivy.metrics.html#kivy.metrics.inch" title="kivy.metrics.inch"><code>inch</code></a>， <a href="https://kivy.org/docs/api-kivy.metrics.html#kivy.metrics.dp" title="kivy.metrics.dp"><code>dp</code></a> and <a href="https://kivy.org/docs/api-kivy.metrics.html#kivy.metrics.sp" title="kivy.metrics.sp"><code>sp</code></a>。可以在<a href="https://kivy.org/docs/api-kivy.metrics.html#module-kivy.metrics" title="kivy.metrics">度量文档 <code>metrics</code></a> 中了解更多相关内容。</p>
<p>你还可以探索一下<a href="https://kivy.org/docs/api-kivy.modules.screen.html#module-kivy.modules.screen" title="kivy.modules.screen">屏幕模块 <code>screen</code></a>的用法，这个可以模拟出不同设备的屏幕，供测试应用。</p>
<h2 id="使用屏幕管理器进行屏幕分割">使用屏幕管理器进行屏幕分割</h2>
<p>如果你的应用程序要包含多个程序，那可能就需要从一个<a href="https://kivy.org/docs/api-kivy.uix.screenmanager.html#kivy.uix.screenmanager.Screen" title="kivy.uix.screenmanager.Screen">屏幕 <code>Screen</code></a>到另一个<a href="https://kivy.org/docs/api-kivy.uix.screenmanager.html#kivy.uix.screenmanager.Screen" title="kivy.uix.screenmanager.Screen">屏幕 <code>Screen</code></a>提供一个导航的通道。幸运的是，正好有一个<a href="https://kivy.org/docs/api-kivy.uix.screenmanager.html#kivy.uix.screenmanager.ScreenManager" title="kivy.uix.screenmanager.ScreenManager">屏幕管理器类<code>ScreenManager</code></a>，这个类允许你来定义分开的各个屏幕，设置屏幕管理器的<a href="https://kivy.org/docs/api-kivy.uix.screenmanager.html#kivy.uix.screenmanager.TransitionBase" title="kivy.uix.screenmanager.TransitionBase"><code>TransitionBase</code></a>就可以实现从一个屏幕到另一个屏幕的跳转导航。</p>
<h1 id="图形">图形</h1>
<p><a href="https://kivy.org/docs/guide/graphics.html">英文原文</a></p>
<h2 id="译者前言">译者前言</h2>
<p>这一章节比前两章节简单很多，翻译的也比较顺了。</p>
<h2 id="简介canvas">简介Canvas</h2>
<p>Kivy中控件图形呈现是使用Canvas完成的，可以将其看作一个无限的绘图板，也是一组绘图指令。有很多种绘图指令都可以应用或者添加到你的Canvas伤，不过总体上分为两类：</p>
<ul>
<li><a href="https://kivy.org/docs/api-kivy.graphics.context_instructions.html#module-kivy.graphics.context_instructions"><code>context instructions</code>环境指令</a></li>
<li><a href="https://kivy.org/docs/api-kivy.graphics.vertex_instructions.html#module-kivy.graphics.vertex_instructions"><code>vertex instructions</code>顶点指令</a></li>
</ul>
<p><a href="https://kivy.org/docs/api-kivy.graphics.context_instructions.html#module-kivy.graphics.context_instructions"><code>context instructions</code>环境指令</a>不绘制任何图形，但会改变<a href="https://kivy.org/docs/api-kivy.graphics.vertex_instructions.html#module-kivy.graphics.vertex_instructions"><code>vertex instructions</code>顶点指令</a>的绘制结果。</p>
<p>Canvas都包含两个指令分支。分别是<a href="https://kivy.org/docs/api-kivy.graphics.html#kivy.graphics.Canvas.before"><code>canvas.before</code></a>和<a href="https://kivy.org/docs/api-kivy.graphics.html#kivy.graphics.Canvas.after"><code>canvas.after</code></a> 这两种指令群。这两组指令分别在<code>Canvas</code>图形绘制前后执行。 绘制前的会被绘制的图形覆盖掉，绘制后的会覆盖在图形上层。这些指令都在用户对它们读取之后才会被创建。</p>
<p>要对一个控件添加Canvas绘图指令，需要使用Canvas环境指令：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyWidget</span>(Widget):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(MyWidget, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas:
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># add your instruction for main canvas here</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 这里是增加一个座位主绘图的指令</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas<span style="color:#000;font-weight:bold">.</span>before:
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># you can use this to add instructions rendered before</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 这里可以在绘图之前添加指令</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas<span style="color:#000;font-weight:bold">.</span>after:
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># you can use this to add instructions rendered after</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic"># 这里可以在绘图之后添加指令</span>
</span></span></code></pre></div><h2 id="环境指令">环境指令</h2>
<p>环境指令是用于操作opengl环境。 可以旋转，翻译和缩放画布。还可以附加纹理或更改绘图颜色。下面这段代码里面的是最常用到的更改颜色的指令，其他的环境指令也都很有用处：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas<span style="color:#000;font-weight:bold">.</span>before:
</span></span><span style="display:flex;"><span>    Color(<span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">.4</span>, mode<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;rgb&#39;</span>)
</span></span></code></pre></div><h2 id="绘图指令">绘图指令</h2>
<p>绘图指令可简可繁，最简单的比如画一个多边形，更复杂的比如绘制网格或者贝塞尔曲线都可以：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas:
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic"># draw a line using the default color</span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic"># 用默认颜色画一条线</span>
</span></span><span style="display:flex;"><span>   Line(points<span style="color:#000;font-weight:bold">=</span>(x1, y1, x2, y2, x3, y3))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic"># lets draw a semi-transparent red square</span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic"># 接下来画一个半透明的红方块</span>
</span></span><span style="display:flex;"><span>   Color(<span style="color:#099">1</span>, <span style="color:#099">0</span>, <span style="color:#099">0</span>, <span style="color:#099">.5</span>, mode<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;rgba&#39;</span>)
</span></span><span style="display:flex;"><span>   Rectangle(pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pos, size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>size)
</span></span></code></pre></div><h2 id="操作指令">操作指令</h2>
<p>有时候可能需要把之前添加到Canvas绘图上的指令进行更改或者删除，这可以有很多种办法，要根据具体需求来选择：</p>
<p>可以给指令创建一个引用然后对其进行更新：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyWidget</span>(Widget):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(MyWidget, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect <span style="color:#000;font-weight:bold">=</span> Rectangle(pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pos, size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>size)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>update_rect)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>update_rect)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">update_rect</span>(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">*</span>args):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect<span style="color:#000;font-weight:bold">.</span>pos <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pos
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect<span style="color:#000;font-weight:bold">.</span>size <span style="color:#000;font-weight:bold">=</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>size
</span></span></code></pre></div><p>或者也可以清空Canvas画布然后重新画：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyWidget</span>(Widget):
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> __init__(<span style="color:#999">self</span>, <span style="color:#000;font-weight:bold">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#0086b3">super</span>(MyWidget, <span style="color:#999">self</span>)<span style="color:#000;font-weight:bold">.</span>__init__(<span style="color:#000;font-weight:bold">**</span>kwargs)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>draw_my_stuff()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>draw_my_stuff)
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>bind(size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>draw_my_stuff)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">def</span> <span style="color:#900;font-weight:bold">draw_my_stuff</span>(<span style="color:#999">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas<span style="color:#000;font-weight:bold">.</span>clear()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">with</span> <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>canvas:
</span></span><span style="display:flex;"><span>            <span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>rect <span style="color:#000;font-weight:bold">=</span> Rectangle(pos<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>pos, size<span style="color:#000;font-weight:bold">=</span><span style="color:#999">self</span><span style="color:#000;font-weight:bold">.</span>size)
</span></span></code></pre></div><p>要注意更新指令的方法是更好的选择，因为这样减少了开销，并且避免了创建新指令。</p>

    </div>

    

    

    <div class="container-prevnext">
    <div><a href="https://one-ruri.github.io/posts/nanui%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/">← NanUI使用文档</a></div>
    <div><a href="https://one-ruri.github.io/posts/ubuntu%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/">Ubuntu部署记录  →</a></div>
</div>
    
    <div class="container-comment">
	<script src="https://utteranc.es/client.js"
        repo="loveminimal/comment"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
	</script>
</div>

    
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        豫ICP备2022002918号-1
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
    
</div></div>
    </body>
</html>
